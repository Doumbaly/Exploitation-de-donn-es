                                ############################################################
                                #########SERIE TEMPORELLE & EXPLOITATIONS DE DONNEES########
                                ############################################################




                               #####################################                
                               ###########SERIE TEMPORELLE##########
                               #####################################


##QUESTION 1##

yt=read.table(file="C:/Users/doums/Desktop/cours Vannes/Lardjane/Projets/IPI.txt",header=T,sep=';',dec=',')
yt
yt=yt[,2]
yt
yt=ts(yt, frequency =12, start = c(1999, 1))
ts.plot(yt)
dec=decompose(yt)
plot(dec,col="blue")

##Les tests de stationnarite##
library(tseries)
library(timeSeries) 
adf.test(yt,alternative = "stationary") 


#
diff(yt)
diff(yt,12)
diff(diff(yt,12))

par(mfrow=c(2,2))
acf(yt,lag.max=30,plot=T)
acf(yt,lag.max=30,type="partial",plot=T)

acf(diff(yt),lag.max=30,plot=T)
acf(diff(yt),lag.max=30,type="partial",plot=T)

acf(diff(yt,12),lag.max=30,plot=T)
acf(diff(yt,12),lag.max=30,type="partial",plot=T)

acf(diff(diff(yt,12)),lag.max=30,plot=T)
acf(diff(diff(yt,12)),lag.max=30,type="partial",plot=T)


var(yt)
var(diff(yt))
var(diff(yt,12))
var(diff(diff(yt,12)))

#au vu des autocorélogrammes, il est plus justifié de prendre diff(yt,12)
#(meilleure enveloppe exponentielle)
#au vu des autocor partiels, prendre diff(yt,12) est plus parcimonieux

##Choix du modele ##

# on étudie : (2 0 2)(0 1 2)12 #

wt=diff(yt,12)
mean(wt)
arim=arima(wt, order = c(2,0,2),
       seasonal = list(order = c(1,0,2), period = 12),
       include.mean = T,method = "ML")#xreg=xt) 
arim
attributes(arim)
arim$coef
cte=(1-arim$coef[[1]])*arim$coef[[3]]
cte

#modele:(I-0.50B-0.328B2-0.321B3)((I-B12)yt-0.055)=(I-0.212B-0.699B2-0.236B3)*epsilon(t)#

##QUESTION 2##

zt1=wt/dec$seasonal
ts.plot(zt)
dec1=decompose(zt1)
plot(dec1,col=8)

##QUESTION 3##

residus=arim$residuals
plot(arim$residuals)
acf(residus,lag.max=30,plot=T)

Box.test(arim$residuals, lag =6, type = c( "Box-Pierce"),fitdf = 2)

hist(arim$residuals,col="cyan") 

##QUESTION 4## 

arim=arima(wt, order = c(2, 0, 2),
       seasonal = list(order = c(2, 0, 1), period = 12),
       include.mean = T,method = "ML")
prediction=predict(arim, n.ahead = 12, se.fit = T)#, newxreg = NULL )
mm=prediction$pred
mstd1=mm-prediction$se*1.96
mstd2=mm+prediction$se*1.96
mm
mstd1
mstd2
m1=prediction$se*1.96

#PREVISIONS#

par(mfrow=c(2,1))
yyt=ts(yt[1:214],start=1)
ts.plot(yyt,mm,mstd1,mstd2)
lines(mstd11, col="red")
lines(mstd22, col="red")
lines(mmm, col="green")

#methode 2#
library(forecast)
plot(forecast(arim,12,level=95))
 


                                      

                                                  ##################################################
                                                  ####Sondage et Exploitation de données d’enquête##
                                                  ##################################################



##Importation du jeux de donnees dans R wt visualisation##

xt=read.table(file="C:/Users/doums/Desktop/cours Vannes/Lardjane/Projets/dd.txt",header=T,sep=';')
View(xt)

##Quelles sont les individus et les variables dans ce jeu de données##

dim(xt)

##Donner le type de chacune des variables##

str(xt)

##Vérifier que R interprète bien chaque variable qualitative en facteur, corriger si besoin.##

xt$CNTY<-factor(xt$CNTY,labels = c("Eure(27)","Nord(59)","Orne(61)","Sein e-Maritime(76)")) 
xt$CNTY 

xt$DIFF<-factor(xt$DIFF,labels = c("Non","Oui"))

xt$STATUS<-factor(xt$STATUS,labels = c("Entreprise","Individuel")) 
xt$OWNLAND<-factor(xt$OWNLAND,labels = c("Non proprietaire","Proprietaire"))
xt$ToF<-factor(xt$ToF,labels=c("Elevage","Cereales","Mix","Autres1","Autres2 ","Autres3")) 
levels(xt$ToF)[4:6]<-"Autres"  

                                   ####Analyse des exploitations etudies####


##3.Quels départements français ont été étudiés dans ce jeu de données##

table(xt$CNTY) 

##4.Quel est le nombre d’exploitants étudiés dans l’échantillon ##
 
length(xt$Num)

#Quel pourcentage sont en défaut de paiement ?#

prop.table(table(xt$DIFF))

##Quel pourcentage sont propriétaires de leur exploitation ? ##

prop.table(table(xt$OWNLAND))

##5.Representation de la repartition de l'age des exploitants##

hist(xt$AGE,main = "Répartition de l'âge des exploitants",xlab = "Age",ylab = "Effectif",col="gray") 
summary(xt$AGE)
prop.table(table(xt$AGE))

###Question 6###

hist(hectare,main = "Répartition des surfaces d'exploitation",xlab = "Surface",ylab = "Effectif",col="cyan") 
summary(hectare) 
sort(hectare)
hec_cnty=cbind(xt$CNTY,hectare)
hec_cnty ##ils appatiennent au departement##
hec_cnty_max=hec_cnty[1251:1260,]
##la taille minimal est 99 ##

##QUESTION 7 ##

table(xt$ToF) #LES mix sont les plus frequentes#

##QUESTION 8##

hectare=as.numeric(xt[,5])
HEC.c<-cut(hectare,quantile(hectare),include.lowest= T,right=F) 
plot(HEC.c,xt$CNTY) 
 
##QUESTION 9##

aggregate(hectare~CNTY,xt,mean) ## 


##QUESTION 10##

barplot(table(xt$STATUS,HEC.c),main="Répartition des surfaces d'e xploitation selon le statut de l'exploitation",xlab="Surface en classe",ylab="Effe ctif",legend.text=c("Entreprise","Individuel")) 


##QUESTION 11##

table(xt$ToF,xt$CNTY) 

##QUESTION 12##

aggregate(hectare~xt$OWNLAND,xt,mean)
aggregate(xt$AGE~xt$OWNLAND,xt,mean)
table(xt$ToF,xt$OWNLAND)  #dans Autres#

##QUESTION 13##
 
plot(table(HEC.c,xt$DIFF),main = "Répartition de la taille des exploitants",col="pink") 


##QUESTION 14##

table(xt$DIFF,xt$CNTY) 
plot(table(xt$DIFF,xt$CNTY),main = "Répartition cond de la variable DIFF et CNTY",col=c("green","white","gray",12))  

##QUESTIOON 15##
table(xt$DIFF,HEC.c)
plot(table(xt$DIFF,HEC.c),main = "Répartition cond de la variable DIFF et HECTARE",col=c("green","white","gray",12))  

table(xt$DIFF,xt$ToF)
plot(table(xt$DIFF,xt$ToF),main = "Répartition cond de la variable DIFF et ToF",col=c("gray","white",6))  

table(xt$DIFF,xt$STATUS)
plot(table(xt$DIFF,xt$STATUS),main = "Répartition cond de la variable DIFF et STATUS",col=c("red","cyan"))  

table(xt$DIFF,xt$OWNLAND)
plot(table(xt$DIFF,xt$OWNLAND),main = "Répartition cond de la variable DIFF et OWNLAND")  

AGE.c<-cut(xt$AGE,quantile(xt$AGE),include.lowest= T,right=F) 
table(xt$DIFF,AGE.c)
plot(table(xt$DIFF,AGE.c),main = "Répartition cond de la variable DIFF et AGE",col=c("green","white","gray",12))  

 





























